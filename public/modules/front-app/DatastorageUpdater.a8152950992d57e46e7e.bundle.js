(self.webpackChunk=self.webpackChunk||[]).push([[1999,227,8450],{6610:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{Z:function(){return n}})},5991:function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.d(t,{Z:function(){return a}})},71743:function(e,t,r){"use strict";var n=r(6610),a=r(5991),o=r(83465),u=r.n(o),i=r(29208),s=r.n(i),c=r(31468),p=r.n(c),f=r(38394),l=r.n(f),d=r(96633),h=r.n(d),g=r(99245),m=r.n(g),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.Z)(this,e),this.data=u()(t)}return(0,a.Z)(e,[{key:"getData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?u()(this.data):this.data}},{key:"isEmpty",value:function(){return m()(this.data)}},{key:"getProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return s()(this.data,e,t)}},{key:"hasProperty",value:function(e){return l()(this.data,e)}},{key:"setProperty",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r instanceof e&&(r=r.getData(!1)),p()(this.data,t,r)}},{key:"unsetProperty",value:function(e){return h()(this.data,e)}}]),e}();window.AltrpModel=v,t.Z=v},69705:function(e,t,r){"use strict";r.r(t);var n=r(92137),a=r(6610),o=r(5991),u=r(10379),i=r(46070),s=r(77608),c=r(87757),p=r.n(c),f=r(26553),l=r(46221),d=r(32869);function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){i=!0,o=e},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw o}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=window.altrpHelpers,v=m.Resource,y=m.isJSON,S=m.mbParseJSON,b=m.replaceContentWithData,w=function(e){(0,u.Z)(w,e);var t,r,c,g,m=(c=w,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,s.Z)(c);if(g){var r=(0,s.Z)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,i.Z)(this,e)});function w(e){var t;return(0,a.Z)(this,w),(t=m.call(this,e)).onStoreUpdate=(0,n.Z)(p().mark((function e(){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=appStore.getState().formsStore,_.isEqual(t.getProperty("formsStore"),r)||!t.getProperty("updated")){e.next=5;break}return t.setProperty("formsStore",r),e.next=5,t.onFormsUpdate();case 5:case"end":return e.stop()}}),e)}))),t.setProperty("dataSourcesFormsDependent",[]),t.setProperty("formsStore",appStore.getState().formsStore),appStore.subscribe(t.onStoreUpdate),t}return(0,o.Z)(w,[{key:"updateCurrent",value:(r=(0,n.Z)(p().mark((function e(){var t,r,a,o,u,i,s=this,c=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:null,r=!(c.length>1&&void 0!==c[1])||c[1],t=t.map((function(e){return e instanceof d.Z?e:new d.Z(e)})),!appStore.getState().currentUser.isEmpty()){e.next=9;break}return e.next=6,new v({route:"/ajax/current-user"}).getAll();case 6:a=(a=e.sent).data,appStore.dispatch((0,l.a2)(a));case 9:r||_.get(t,"length")||(t=this.getProperty("currentDataSources")),t||(t=[]),r&&(this.setProperty("currentDataSources",t),this.setProperty("updated",!1),t=t.filter((function(e){return e.getProperty("autoload")}))),t=t.filter((function(e){var t=e.getProperty("parameters");return!y(t)||!((t=S(t,[]))&&t.find((function(t){if(-1===t.paramValue.toString().indexOf("altrpforms."))return!1;var n=e.getParams(window.currentRouterMatch.data.params,"altrpforms.");if(r&&s.subscribeToFormsUpdate(e,n),!t.required)return!1;var a=t.paramValue||"";return-1!==a.indexOf("{{")&&(a=b(a)),!a})))})),o={},t.forEach((function(e){o[e.getProperty("priority")]=o[e.getProperty("priority")]||[],o[e.getProperty("priority")].push(e)})),r&&appStore.dispatch((0,f.PL)()),e.t0=p().keys(o);case 17:if((e.t1=e.t0()).done){e.next=31;break}if(u=e.t1.value,o.hasOwnProperty(u)){e.next=21;break}return e.abrupt("continue",17);case 21:return r&&appStore.dispatch((0,f.PL)()),i=o[u].map(function(){var e=(0,n.Z)(p().mark((function e(n){var a,o,u,i,c,l;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.getWebUrl()){e.next=46;break}if(a=n.getParams(window.currentRouterMatch.params,"altrpforms."),o=_.cloneDeep(a),u=!1,_.each(a,(function(e,t){0===e.toString().indexOf("altrpforms.")&&(a[t]=_.get(appStore.getState().formsStore,e.toString().replace("altrpforms.",""),""),u=!0)})),u&&r&&s.subscribeToFormsUpdate(n,_.cloneDeep(o)),i={},e.prev=7,!(c=_.get(window.altrpPreloadedDatasources,n.getAlias()))){e.next=14;break}i=c,_.unset(window.altrpPreloadedDatasources,n.getAlias()),e.next=32;break;case 14:if("show"!==n.getType()){e.next=22;break}if(!(l=_.get(a,"id",_.get(s.props,"match.params.id")))){e.next=20;break}return e.next=19,new v({route:n.getWebUrl()}).get(l);case 19:i=e.sent;case 20:e.next=32;break;case 22:if(_.isEmpty(a)){e.next=29;break}return e.next=25,new v({route:n.getWebUrl()}).getQueried(a);case 25:i=e.sent,n.params=_.cloneDeep(a),e.next=32;break;case 29:return e.next=31,new v({route:n.getWebUrl()}).getAll();case 31:i=e.sent;case 32:e.next=41;break;case 34:if(e.prev=34,e.t0=e.catch(7),!(e.t0 instanceof Promise)){e.next=40;break}return e.next=39,e.t0.then();case 39:e.t0=e.sent;case 40:console.error(e.t0);case 41:return i=_.get(i,"data",i),(t=t.filter((function(e){return e!==n}))).length||s.setProperty("updated",!0),appStore.dispatch((0,f.cC)(n.getAlias(),i)),e.abrupt("return",i);case 46:case"end":return e.stop()}}),e,null,[[7,34]])})));return function(t){return e.apply(this,arguments)}}()),console.log("Update Datasource Start: ",performance.now()),e.next=26,Promise.all(i);case 26:e.sent,console.log("Update Datasource End: ",performance.now()),r&&appStore.dispatch((0,f.vt)()),e.next=17;break;case 31:t.length||appStore.dispatch((0,f.vt)());case 32:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearCurrent",value:function(){this.unsetProperty("currentDataSources"),this.setProperty("dataSourcesFormsDependent",[]),appStore.dispatch((0,f.qS)())}},{key:"subscribeToFormsUpdate",value:function(e,t){var r=this.getProperty("dataSourcesFormsDependent");-1===_.findIndex(r,(function(t){return t.dataSource===e}))&&r.push({dataSource:e,params:t})}},{key:"onFormsUpdate",value:(t=(0,n.Z)(p().mark((function e(){var t,r,n,a,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(t=this.getProperty("dataSourcesFormsDependent",[])).filter((function(e){var t=e.dataSource.getProperty("parameters");return!y(t)||!(t=S(t,[])).find((function(e){if(!e.required)return!1;var t=e.paramValue||"";return-1!==t.indexOf("{{")&&(t=b(t)),!t}))})),t=_.sortBy(t,(function(e){return e.priority})),r=appStore.getState().formsStore,n=h(t),e.prev=5,o=p().mark((function e(){var t,n,o,u,i,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.value,n=t.dataSource,o=t.updating,u=_.cloneDeep(n.params),i=n.getParams(window.currentRouterMatch.params,"altrpforms."),_.forEach(i,(function(e,t){0===e.toString().indexOf("altrpforms.")&&(i[t]=_.get(r,e.replace("altrpforms.","")))})),_.isEqual(i,u)||o){e.next=52;break}return n.params=_.cloneDeep(i),t.updating=!0,s={},e.prev=10,e.next=13,new v({route:n.getWebUrl()}).getQueried(i);case 13:s=e.sent,s=_.get(s,"data",s),appStore.dispatch((0,f.cC)(n.getAlias(),s)),e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(10),!(e.t0 instanceof Promise)){e.next=25;break}return e.next=23,e.t0.then();case 23:e.t0=e.sent,e.t0=S(e.t0);case 25:console.error(e.t0);case 26:if(e.prev=26,void 0===t.pendingParameters||_.isEqual(t.pendingParameters,i)){e.next=48;break}return e.prev=28,e.next=31,new v({route:n.getWebUrl()}).getQueried(t.pendingParameters);case 31:s=e.sent,s=_.get(s,"data",s),appStore.dispatch((0,f.cC)(n.getAlias(),s)),n.params=_.cloneDeep(t.pendingParameters),e.next=45;break;case 37:if(e.prev=37,e.t1=e.catch(28),!(e.t1 instanceof Promise)){e.next=44;break}return e.next=42,e.t1.then();case 42:e.t1=e.sent,e.t1=S(e.t1);case 44:console.error(e.t1);case 45:return e.prev=45,_.unset(t,"pendingParameters"),e.finish(45);case 48:return t.updating=!1,e.finish(26);case 50:e.next=53;break;case 52:!_.isEqual(i,u)&&o&&(t.pendingParameters=_.cloneDeep(i));case 53:case"end":return e.stop()}}),e,null,[[10,18,26,50],[28,37,45,48]])})),n.s();case 8:if((a=n.n()).done){e.next=12;break}return e.delegateYield(o(),"t0",10);case 10:e.next=8;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(5),n.e(e.t1);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[5,14,17,20]])}))),function(){return t.apply(this,arguments)})}]),w}(AltrpModel);window.dataStorageUpdater=window.dataStorageUpdater||new w,t.default=window.dataStorageUpdater},26553:function(e,t,r){"use strict";r.d(t,{I3:function(){return n},En:function(){return a},Tg:function(){return o},zM:function(){return u},cC:function(){return i},qS:function(){return s},vt:function(){return c},PL:function(){return p}});var n="CHANGE_CURRENT_DATASOURCE",a="CLEAR_CURRENT_DATASOURCE",o="SET_CURRENT_DATASOURCE_LOADED",u="SET_CURRENT_DATASOURCE_LOADING";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:n,data:t,dataStorageName:e}}function s(){return{type:a}}function c(){return{type:o}}function p(){return{type:u}}}}]);
//# sourceMappingURL=DatastorageUpdater.a8152950992d57e46e7e.bundle.js.map